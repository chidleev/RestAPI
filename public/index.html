<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src='/scripts/vue/dist/vue.global.js'></script>
    <script src='/scripts/axios/dist/axios.min.js'></script>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div id="app">
        <div id="commands">
            <div id="buttons">
                <button v-for="(name, key) in { project: 'Проекты', house: 'Дома', section: 'Подъезды', flat: 'Квартиры' }" @click="currentTab = key" :class="{'active': currentTab == key}">{{name}}</button>
            </div>

            <div v-if="currentTab == 'project'" class="tab">
                <div class="block">
                    <span>Получить все проекты</span>
                    <div></div>
                    <button @click="getProjects">GET Projects</button>
                </div>
    
                <div class="block">
                    <span>Получить проект по ID</span>
                    <input type="text" v-model.number="Project.Id" placeholder="ID объекта">
                    <button @click="getProjectById">GET Project by ID</button>
                </div>
    
                <div class="block">
                    <span>Создание проекта</span>
                    <input type="text" v-model="Project.name" placeholder="Название объекта">
                    <input type="text" v-model="Project.coords" placeholder="Координаты объекта">
                    <input type="text" v-model="Project.district" placeholder="Район города">
                    <input type="url" v-model="Project.website" placeholder="Сайт объекта">
                    <div></div>
                    <button @click="createProjectReq">Create Project</button>
                </div>
    
                <div class="block">
                    <span>Редактирование проекта по ID</span>
                    <input type="text" v-model.number="Project.Id" placeholder="ID объекта">
                    <input type="text" v-model="Project.name" placeholder="Название объекта">
                    <input type="text" v-model="Project.coords" placeholder="Координаты  объекта">
                    <input type="text" v-model="Project.district" placeholder="Район города">
                    <input type="url" v-model="Project.website" placeholder="Сайт объекта">
                    <button @click="patchProjectById">Patch Project</button>
                </div>
            </div>
            
            <div v-if="currentTab == 'house'" class="tab">
                <div class="block">
                    <span>Создание дома</span>
                    <input type="text" v-model="House.project_id" placeholder="ID объекта">
                    <input type="text" v-model="House.name" placeholder="Название дома">
                    <input type="text" v-model="House.address" placeholder="Адрес объекта">
                    <input type="number" min="1000" max="9999" v-model="House.built_year" placeholder="Год сдачи">
                    <input type="number" min="1" max="4" v-model="House.built_quarter" placeholder="Квартал сдачи">
                    <button @click="createHouseReq">Create House</button>
                </div>
            </div>

            <div v-if="currentTab == 'section'" class="tab">
                <div class="block">
                    <span>Создание подъезда</span>
                    <input type="text" v-model="Section.house_id" placeholder="ID объекта">
                    <input type="text" v-model="Section.number" placeholder="Название дома">
                    <input type="text" v-model="Section.floors" placeholder="Адрес объекта">
                    <input type="number" min="2000" max="3000" v-model="Section.flats_on_floor" placeholder="Год сдачи">
                    <input type="number" min="1" max="4" v-model="Section.starting_flat_number" placeholder="Квартал сдачи">
                    <button @click="createSectionReq">Create Section</button>
                </div>
            </div>

            <div v-if="currentTab == 'flat'" class="tab">

            </div>
        </div>

        <div id="panel">
            <div class="block">
                <input type="text" v-model="login" placeholder="Логин">
                <input type="text" v-model="password" placeholder="Пароль">
                <button @click="loginReq">Login</button>
            </div>
            <div class="block">
                <span>Token: {{token || "отсутствует"}}</span>
                <button @click="deleteToken">Удалить токен</button>
            </div>

            <div id="response">
                <h1>Ответ сервера:</h1>
                <p style="white-space: pre-wrap; background-color: rgb(240, 255, 240);">{{formatJSON(goodRes)}}</p>
                <p style="white-space: pre-wrap; background-color: rgb(255, 240, 240);">{{formatJSON(badRes)}}</p>
            </div>
        </div>
    </div>
    

    <script>
        const settings = {
            data() {
                return {
                    currentTab: 'project',
                    login: "",
                    password: "",
                    goodRes: {},
                    badRes: {},
                    token: 1,
                    Project: {},
                    House: {},
                    Section: {},
                    Flat: {},

                    HOST: /*'http://192.168.1.203:3000'*/''
                }
            },
            methods: {
                loginReq() {
                    axios({
                        url: `${this.HOST}/api/login`,
                        method: 'post',
                        headers: {
                            "Content-Type": "application/json"
                        },
                        data: {
                            "login": this.login,
                            "password": this.password
                        }
                    })
                    .then(response => {
                        this.setGoodRes(response)
                        this.token = response.data.data.token
                    })
                    .catch(this.setBadRes)
                },

                getProjects() {
                    axios({
                        url: `${this.HOST}/api/project`,
                        method: 'get',
                        headers: {
                            "authorization": this.token
                        }
                    })
                    .then(this.setGoodRes)
                    .catch(this.setBadRes)
                },

                createProjectReq() {
                    axios({
                        url: `${this.HOST}/api/project`,
                        method: 'post',
                        headers: {
                            "Content-Type": "application/json",
                            "authorization": this.token
                        },
                        data: {
                            "name": this.Project.name,
                            "coords": this.Project.coords,
                            "district": this.Project.district,
                            "website": this.Project.website
                        }
                    })
                    .then(response => {
                        this.setGoodRes(response)
                        this.Project.Id = response.data.data.id
                    })
                    .catch(this.setBadRes)
                },

                getProjectById() {
                    axios({
                        url: `${this.HOST}/api/project/${this.Project.Id}`,
                        method: 'get',
                        headers: {
                            "authorization": this.token
                        }
                    })
                    .then(this.setGoodRes)
                    .catch(this.setBadRes)
                },

                patchProjectById() {
                    axios({
                        url: `${this.HOST}/api/project/${this.Project.Id}`,
                        method: 'patch',
                        headers: {
                            "Content-Type": "application/json",
                            "authorization": this.token
                        },
                        data: {
                            "name": this.Project.name,
                            "coords": this.Project.coords,
                            "district": this.Project.district,
                            "website": this.Project.website
                        }
                    })
                    .then(this.setGoodRes)
                    .catch(this.setBadRes)
                },














                setGoodRes(res) {
                    this.badRes = {}
                    this.goodRes.status = res.status
                    this.goodRes.contentType = res.headers["content-type"]
                    this.goodRes.body = res.data
                },

                setBadRes(err) {
                    this.goodRes = {}
                    this.badRes.status = err.response.status
                    this.badRes.contentType = err.response.headers["content-type"]
                    this.badRes.body = err.response.data
                },

                formatJSON(data) {
                    return JSON.stringify(data, null, '\t')
                },

                deleteToken() {
                    this.token = null
                }
            }
        }

        const app = Vue.createApp(settings).mount('div#app')
    </script>
</body>
</html>